(function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image","./load-image-meta"],e):"object"==typeof module&&module.exports?e(require("./load-image"),require("./load-image-meta")):e(window.loadImage)})(function(e){"use strict";e.ExifMap=function(){return this},e.ExifMap.prototype.map={Orientation:274},e.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]},e.getExifThumbnail=function(e,i,t){var n,a,f;if(!t||i+t>e.byteLength)return void console.log("Invalid Exif data: Invalid thumbnail data.");for(n=[],a=0;a<t;a+=1)f=e.getUint8(i+a),n.push((f<16?"0":"")+f.toString(16));return"data:image/jpeg,%"+n.join("%")},e.exifTagTypes={1:{getValue:function(e,i){return e.getUint8(i)},size:1},2:{getValue:function(e,i){return String.fromCharCode(e.getUint8(i))},size:1,ascii:!0},3:{getValue:function(e,i,t){return e.getUint16(i,t)},size:2},4:{getValue:function(e,i,t){return e.getUint32(i,t)},size:4},5:{getValue:function(e,i,t){return e.getUint32(i,t)/e.getUint32(i+4,t)},size:8},9:{getValue:function(e,i,t){return e.getInt32(i,t)},size:4},10:{getValue:function(e,i,t){return e.getInt32(i,t)/e.getInt32(i+4,t)},size:8}},e.exifTagTypes[7]=e.exifTagTypes[1],e.getExifValue=function(i,t,n,a,f,r){var o,g,s,u,l,d,x=e.exifTagTypes[a];if(!x)return void console.log("Invalid Exif data: Invalid tag type.");if(o=x.size*f,g=o>4?t+i.getUint32(n+8,r):n+8,g+o>i.byteLength)return void console.log("Invalid Exif data: Invalid data offset.");if(1===f)return x.getValue(i,g,r);for(s=[],u=0;u<f;u+=1)s[u]=x.getValue(i,g+u*x.size,r);if(x.ascii){for(l="",u=0;u<s.length&&(d=s[u],"\0"!==d);u+=1)l+=d;return l}return s},e.parseExifTag=function(i,t,n,a,f){var r=i.getUint16(n,a);f.exif[r]=e.getExifValue(i,t,n,i.getUint16(n+2,a),i.getUint32(n+4,a),a)},e.parseExifTags=function(e,i,t,n,a){var f,r,o;if(t+6>e.byteLength)return void console.log("Invalid Exif data: Invalid directory offset.");if(f=e.getUint16(t,n),r=t+2+12*f,r+4>e.byteLength)return void console.log("Invalid Exif data: Invalid directory size.");for(o=0;o<f;o+=1)this.parseExifTag(e,i,t+2+12*o,n,a);return e.getUint32(r,n)},e.parseExifData=function(i,t,n,a,f){if(!f.disableExif){var r,o,g,s=t+10;if(1165519206===i.getUint32(t+4)){if(s+8>i.byteLength)return void console.log("Invalid Exif data: Invalid segment size.");if(0!==i.getUint16(t+8))return void console.log("Invalid Exif data: Missing byte alignment offset.");switch(i.getUint16(s)){case 18761:r=!0;break;case 19789:r=!1;break;default:return void console.log("Invalid Exif data: Invalid byte alignment marker.")}if(42!==i.getUint16(s+2,r))return void console.log("Invalid Exif data: Missing TIFF marker.");o=i.getUint32(s+4,r),a.exif=new e.ExifMap,o=e.parseExifTags(i,s,s+o,r,a),o&&!f.disableExifThumbnail&&(g={exif:{}},o=e.parseExifTags(i,s,s+o,r,g),g.exif[513]&&(a.exif.Thumbnail=e.getExifThumbnail(i,s+g.exif[513],g.exif[514]))),a.exif[34665]&&!f.disableExifSub&&e.parseExifTags(i,s,s+a.exif[34665],r,a),a.exif[34853]&&!f.disableExifGps&&e.parseExifTags(i,s,s+a.exif[34853],r,a)}}},e.metaDataParsers.jpeg[65505].push(e.parseExifData)});