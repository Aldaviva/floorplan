(function(t){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],t):t("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)})(function(t){"use strict";var e=t.transform;t.transform=function(i,o,a,n,r){e.call(t,t.scale(i,o,r),o,a,n,r)},t.transformCoordinates=function(){},t.getTransformedOptions=function(t,e){var i,o,a,n,r=e.aspectRatio;if(!r)return e;i={};for(o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);return i.crop=!0,a=t.naturalWidth||t.width,n=t.naturalHeight||t.height,a/n>r?(i.maxWidth=n*r,i.maxHeight=n):(i.maxWidth=a,i.maxHeight=a/r),i},t.renderImageToCanvas=function(t,e,i,o,a,n,r,h,d,s){return t.getContext("2d").drawImage(e,i,o,a,n,r,h,d,s),t},t.hasCanvasOption=function(t){return t.canvas||t.crop||!!t.aspectRatio},t.scale=function(e,i,o){function a(){var t=Math.max((d||H)/H,(s||W)/W);t>1&&(H*=t,W*=t)}function n(){var t=Math.min((r||H)/H,(h||W)/W);t<1&&(H*=t,W*=t)}i=i||{};var r,h,d,s,c,g,m,u,f,v,l,p=document.createElement("canvas"),x=e.getContext||t.hasCanvasOption(i)&&p.getContext,w=e.naturalWidth||e.width,C=e.naturalHeight||e.height,H=w,W=C;if(x&&(i=t.getTransformedOptions(e,i,o),m=i.left||0,u=i.top||0,i.sourceWidth?(c=i.sourceWidth,void 0!==i.right&&void 0===i.left&&(m=w-c-i.right)):c=w-m-(i.right||0),i.sourceHeight?(g=i.sourceHeight,void 0!==i.bottom&&void 0===i.top&&(u=C-g-i.bottom)):g=C-u-(i.bottom||0),H=c,W=g),r=i.maxWidth,h=i.maxHeight,d=i.minWidth,s=i.minHeight,x&&r&&h&&i.crop?(H=r,W=h,l=c/g-r/h,l<0?(g=h*c/r,void 0===i.top&&void 0===i.bottom&&(u=(C-g)/2)):l>0&&(c=r*g/h,void 0===i.left&&void 0===i.right&&(m=(w-c)/2))):((i.contain||i.cover)&&(d=r=r||d,s=h=h||s),i.cover?(n(),a()):(a(),n())),x){if(f=i.pixelRatio,f>1&&(p.style.width=H+"px",p.style.height=W+"px",H*=f,W*=f,p.getContext("2d").scale(f,f)),v=i.downsamplingRatio,v>0&&v<1&&H<c&&W<g)for(;c*v>H;)p.width=c*v,p.height=g*v,t.renderImageToCanvas(p,e,m,u,c,g,0,0,p.width,p.height),m=0,u=0,c=p.width,g=p.height,e=document.createElement("canvas"),e.width=c,e.height=g,t.renderImageToCanvas(e,p,0,0,c,g,0,0,c,g);return p.width=H,p.height=W,t.transformCoordinates(p,i),t.renderImageToCanvas(p,e,m,u,c,g,0,0,H,W)}return e.width=H,e.height=W,e}});