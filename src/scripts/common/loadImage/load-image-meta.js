(function(e){"use strict";"function"==typeof define&&define.amd?define(["./load-image"],e):e("object"==typeof module&&module.exports?require("./load-image"):window.loadImage)})(function(e){"use strict";var t="undefined"!=typeof Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);e.blobSlice=t&&function(){var e=this.slice||this.webkitSlice||this.mozSlice;return e.apply(this,arguments)},e.metaDataParsers={jpeg:{65505:[]}},e.parseMetaData=function(t,a,i,o){i=i||{},o=o||{};var r=this,n=i.maxMetaDataSize||262144,l=!("undefined"!=typeof DataView&&t&&t.size>=12&&"image/jpeg"===t.type&&e.blobSlice);!l&&e.readFile(e.blobSlice.call(t,0,n),function(t){if(t.target.error)return console.log(t.target.error),void a(o);var n,l,s,c,f=t.target.result,d=new DataView(f),g=2,p=d.byteLength-4,u=g;if(65496===d.getUint16(0)){for(;g<p&&(n=d.getUint16(g),n>=65504&&n<=65519||65534===n);){if(l=d.getUint16(g+2)+2,g+l>d.byteLength){console.log("Invalid meta data: Invalid segment size.");break}if(s=e.metaDataParsers.jpeg[n])for(c=0;c<s.length;c+=1)s[c].call(r,d,g,l,o,i);g+=l,u=g}!i.disableImageHead&&u>6&&(f.slice?o.imageHead=f.slice(0,u):o.imageHead=new Uint8Array(f).subarray(0,u))}else console.log("Invalid JPEG file: Missing JPEG marker.");a(o)},"readAsArrayBuffer")||a(o)},e.hasMetaOption=function(e){return e&&e.meta};var a=e.transform;e.transform=function(t,i,o,r,n){e.hasMetaOption(i)?e.parseMetaData(r,function(n){a.call(e,t,i,o,r,n)},i,n):a.apply(e,arguments)}});